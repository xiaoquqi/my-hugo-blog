---
title: 某股权交易中心业务迁移阿里云最佳实践
author: 孙琦(Ray)
date: 2021-02-05 17:35:56 +08:00
tags:
---
## 项目概述

某股权交易中心是在深圳地区建设的市场化运作的区域性交易市场。由于业务发展需要，用户需要将主要业务全面上云。最终用户选择使用万博智云HyperMotion将业务系统迁移至阿里公有云平台，在保障用户业务连续性的前提下，实现业务系统全面上云。

## 客户面临的挑战

用户原有业务系统运行在运营商机房内，该机房将整体清退，主要应用系统已切换至备用机房。但备用机房规模较小、总体运维成本较高。由于公司发展需要，运维团队规模由原来的十人缩减为一人。为满足业务快速发展以及系统业务连续性要求，提升整体运维效率，计划将主要生产系统由本地机房迁移至阿里云。

用户采用传统的VMware与存储阵列的经典组合，业务系统由100多台虚拟机、10+TB数据量构成，用户需要将这100多台VMware虚拟机平滑的迁移至阿里云平台。

<!-- more -->

## 为什么选择阿里云

用户希望将业务系统部署在领先的、高水准的云平台上，并且一定要求云平台为国产化自主可控的公有云平台。实现“一步到位”的信息化建设高起点，同时作为金融交易平台，用户需要得到全方位的技术保障和极为可靠的安全性和稳定性。

本次在竞标主要竞争是在阿里云和另外一家云商之间展开，由于是金融级别客户，用户重点从【安全产品】和【业务迁移】两个维度对两朵公有云产品及服务能力进行了深度评估。

经过深度评估，选定阿里云安骑士的高配版本和万博智云HyperMotion云迁移为解决方案。

## 为什么选择万博智云

万博智云是国内最早且目前最优的云原生迁移工具研发的公司，通过与阿里云API接口及云原生资源高度自动化对接，将迁移缩减为简单的三步，满足用户高度自动化、智能化迁移需求。

同时通过迁移演练能力，满足了用户在切换至云端前从业务维度对系统进行多次生产演练验证的需求，实现了【灾备演练式的渐进迁移体验】。

通过HyperMotion云迁移工具，实现了：

* 业务连续性迁移
* 批量/高效/全程可视化迁移
* 迁移后IP地址不变
* 上云前多次业务级别演练

充分保障了用户业务上云后的连续性和可靠性。

## 解决方案

### 网络解决方案

用户业务上云后，期望保持与原有数据中心内业务系统IP地址保持一致，这就要求在公有云侧VPC需要使用与原有数据中心相同的IP地址规划。同时在上云后，由于云上的地址通常采用DHCP方式进行分配，这就要求在主机启动前就要将端口及IP进行分配，确保在云端启动的主机获得与原有业务系统完全一样的IP地址。

在该项目中，我们采用【阿里云云联网服务】将用户原有机房网络与云上VPC进行打通，为了避免地址冲突，用户进行数据同步的网络采用单独的地址段，在启动时，通过【HyperMotion指定IP地址】方式进行启动。


### 业务连续性

根据迁移方法论中提到“6R”理论，【重新托管（Re-Host）】方式是上云的最短最高效路径，同时也是对用户原有业务影响最小的方案。

HyperMotion采用了块级别同步复制技术来实现“热迁移”：

* ★源端无代理模式→在源端VMware环境下无入侵操作（不安装agent），对用户业务侧影响几乎为0，实现用户源端业务零停机或者少停机下实现业务系统上云的效果。
* 块级别数据的整体复制→用户的操作系统、应用、数据一起被同步到目标侧，无论是WEB应用、数据库或者中间件，都可以通过这种方式完整的迁移至云端，无需针对单独文件或者数据进行操作和配置。
* ★异构平台适配技术→通过异构平台智能适配转换驱动，实现跨平台无缝迁移
* ★云原生能力→调度云侧API以及逻辑流程，无须繁琐的人为操作，实现高度自动化的用户体验。
* ★灾备演练式渐进迁移
* 业务系统上云验证是迁移上云前最后一道防线，在云侧完整的对业务系统进行验证是最准确和有效的手段。在传统容灾场景中，通常以定期的灾备演练方式来保证灾备的可用性。

在HyperMotion中创新的提供了【★迁移演练的能力】，方便用户在上云前通过灾备演练式的体验进行业务系统切换前的校验。HyperMotion通过对阿里云API进行深度整合，以全自动化的方式解决了主机启动、驱动修复、网络修复等多种上云后复杂的人为操作。同时HyperMotion还可以通过指定IP地址启动方式，保证业务系统与源端地址一致。迁移验证系统启动后，并不影响源端业务运行，同时增量数据可以继续同步至云侧。

本案例中充分发挥了该功能的优势，最大程度满足客户严苛的业务迁移需求。

### 成本

成本因素是迁移到公有云必须要考虑的问题之一，从开始的业务系统同步到迁移演练到最终的迁移上云，均涉及到资源的成本支出，如果无法做到合理的使用云原生资源就会造成大量的浪费。

HyperMotion创新的采用了云同步网关的概念，实现了多对一的方式进行同步。数据同步阶段，只利用较少的计算资源，而将数据存储于云硬盘中，降低成本消耗。真正的业务主机只在验证或最终切换阶段启动，实现成本最优的效果。

客户实际在迁移过程中耗时大概在两个月时间，期间将一百多台多台主机拉起进行了三次验证，每次在业务部门确认后，清理掉资源。最终在第四次拉起后，将业务负载全部切换至云侧。目前用户业务系统已经稳定超过半年以上时间。

以下是我们就该项目中实际消耗的资源&成本 与 备选方案测算进行的比对：

用户【原有系统资源】统计：

![upload successful](/images/pasted-130.png)

迁移【中间资源成本】对比：

项目迁移周期耗时两个月，通过对阿里云账单进行分析，统计出在迁移中间资源、成本、时间如下：

![upload successful](/images/pasted-131.png)
