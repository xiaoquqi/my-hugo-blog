---
title: Gitlab之间进行同步备份
date: 2022-02-14T07:23:44+08:00
draft: true
---

目前，我们公司有两个研发团队，分别在北京和武汉，考虑到访问速度的问题，原有武汉的研发环境在近端部署。也就是北京和武汉分别有两套独立的研发管理环境，虽然这解决了近端访问速度的问题，但是管理上较为分散，比如研发环境备份和恢复就是最重要的问题之一。最近，处于对安全性和合规性的考虑，希望将北京和武汉的源代码，统一的集中备份，防止公司资产流失。

## Gitlab同步备份需求分析

由于历史原因，北京团队使用Gerrit进行代码审核和管理的工具，但是对于很多开发人员来说，入门比较陡峭，需要记忆很多git命令，所以考虑团队扩展性的需要，将Gerrit环境逐步切换至Gitlab中，而武汉团队则是直接选择了Gitlab进行代码管理。

在选择目标侧环境时，原本想使用阿里云效和腾讯的Coding环境进行备份，以我们目前体量来看，是完全免费的。但是考虑到随着公司增长，后期可能会产生成本，所以决定利用现有的K8S生产环境部署一套Gitlab，用于代码备份。

所以本次要解决的问题就是将两个团队Gitlab环境下的所有项目定期备份至远程的Gitlab中。在最初期的方案设计中，想使用最简单的Sehll脚本进行同步，但是会出现以下几个问题要解决：

* 在前期配置过程中，如果待同步项目较多，则在目标端进行预配置的工作较多，增加了管理成本
* 如果在源端有新的代码库增加，则需要至少维护同步脚本和备份端的Gitlab环境进行修改
* 如果还想同步Gitlab上诸如Wiki等文档类页面，则需要额外的手段进行

## 解决过程及思考

基于以上几点考虑，期望寻求一种自动化手段解决该问题，争取实现零运维的效果。

### 解决方案一：利用Gitlab原生机制

### 解决方案二：利用Github上开源项目

### 解决方案三：基于Gitlab CLI实现自动化流程

## 使用方法

## 总结